var HOST="http://localhost:8080";$(function(){$.ajaxSetup({contentType:"application/json"});var e=new Vue({el:"#navbarToggler",data:{loggedIn:!1,user:{},items:[{name:"Home",url:"index.html",active:!1,annoymous:!0,login:!0},{name:"My Diary",url:"mydiary.html",active:!1,annoymous:!1,login:!0},{name:"New Diary",url:"newdiary.html",active:!1,annoymous:!1,login:!0},{name:"Register",url:"register.html",active:!1,annoymous:!0,login:!1},{name:"Login",url:"login.html",active:!1,annoymous:!0,login:!1}]},methods:{menu:function(e){for(var t=[],a=location.pathname,s=0,o=e.length;s<o;s++){var i=e[s];this.loggedIn&&i.login?t.push(i):!this.loggedIn&&i.annoymous&&t.push(i),i.active=a=="/"+i.url}return t},logout:function(){$.post(HOST+"/users/expire",JSON.stringify({token:sessionStorage.getItem("token")}),function(e){e.status&&sessionStorage.setItem("message","You have logged out!"),location.href="index.html"})}}}),t=new Vue({el:"#greeting",data:{loggedIn:!1,user:{},message:sessionStorage.getItem("message")}});sessionStorage.getItem("message")&&(sessionStorage.removeItem("message"),setTimeout(function(){t.message=void 0},1e4)),sessionStorage.getItem("token")&&$.post(HOST+"/users",JSON.stringify({token:sessionStorage.getItem("token")}),function(a){a.status?(e.loggedIn=!0,e.user=a.result,t.loggedIn=!0,t.user=a.result):sessionStorage.removeItem("token")});var a=new Vue({el:"#health-check",data:{status:!1}});$.getJSON(HOST+"/meta/heartbeat",function(e){a.status=!!e.status});var s=new Vue({el:"#maintainers",data:{people:[]}});$.getJSON(HOST+"/meta/members",function(e){e.status&&(s.people=e.result)}),Vue.component("diary-entry",{props:["diary","editable"],data:function(){return{error:void 0}},template:'<div class="card mb-5"><div class="card-header"><span class="text-secondary">{{ moment(diary.publish_date).format("lll") }}</span> by <strong>{{ diary.author }}</strong> <span class="badge badge-primary" v-if="!diary.public">Private</span></div><div class="card-body"><h2 class="card-title">{{ diary.title }}</h2><p class="card-text">{{ diary.text }}</p></div><div class="card-footer" v-if="editable && !error"><a href="#" class="card-link text-danger" v-on:click="deleteDiary">Delete</a><a href="#" class="card-link" v-on:click="togglePermission">{{ diary.public ? "Make Private" : "Make Public" }}</a></div><div class="card-footer text-danger" v-if="editable && error">{{ error }}</div></div>',methods:{togglePermission:function(){$.post(HOST+"/diary/permission",JSON.stringify({token:sessionStorage.getItem("token"),id:this.diary.id,public:!this.diary.public}),function(e){e.status&&location.reload(),this.error=e.error})},deleteDiary:function(){$.post(HOST+"/diary/delete",JSON.stringify({token:sessionStorage.getItem("token"),id:this.diary.id}),function(e){e.status&&location.reload(),this.error=e.error})}}})});